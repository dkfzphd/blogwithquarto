{
  "hash": "3cd681d4c3fa59db408603f305fe2ada",
  "result": {
    "markdown": "---\ntitle: \"MoonPhrase-ggplot2\" \nauthor: \"Te\"\ndate: \"2022-11-08\"\ncategories: [ggplot2, code, analysis]\n---\n\n\n![](Moon-Phrase.png)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# initial configuration\nwindowsFonts()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$serif\n[1] \"TT Times New Roman\"\n\n$sans\n[1] \"TT Arial\"\n\n$mono\n[1] \"TT Courier New\"\n```\n:::\n\n```{.r .cell-code}\n# load new font\nsysfonts::font_add_google(\"Roboto\", family = \"Roboto\")\nsysfonts::font_add_google(\"Lato\", family = \"Lato\")\nsysfonts::font_families()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"sans\"   \"serif\"  \"mono\"   \"Roboto\" \"Lato\"  \n```\n:::\n\n```{.r .cell-code}\n# use it\nshowtext::showtext_auto()\n```\n:::\n\n\n# moon phrase data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(suncalc)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(knitr)\nlibrary(DT)\n\n## use getMoonIllusmination function to get moon fraction, phase, and angle for 2018.\nMoon_2022 <-getMoonIllumination(date = seq.Date(as.Date(\"2022-01-01\"), as.Date(\"2022-12-31\"), by = 1), \n                                 keep = c(\"fraction\", \"phase\", \"angle\"))\n\n\n## Append Extra Info, so I can use ggplot to make calendar. \nMoon_2022_df <- Moon_2022 %>% \n  mutate(wkdy = fct_inorder(weekdays(date, abbreviate=T)), ## 2018 worked well because it starts on Monday\n         wkn = week(date), ## Week Number\n         mo = month(date, label=T, abbr=T), ## Month\n         day = day(date), ## Day\n         moon.phase = cut(#phase,breaks=seq(0,1,by=1/28), ## this doesn't work...\n                          phase,breaks=seq(0,1,by=1/56),\n                          ordered_result=T)) %>%\n  group_by(mo) %>% \n  mutate(wkn.mo = dense_rank(wkn)) %>%\n  ungroup()\n\n## Simply cutting into 28 blocks didn't work out..  \nmoon.font.tb <- tibble(\n  moon.font = c(NA, letters[rep(1:13,rep(2,13))], 0,0, letters[rep(14:26,rep(2,13))],NA),\n  moon.phase = levels(Moon_2022_df$moon.phase)\n)\n\nMoon_2022_df <- Moon_2022_df %>% left_join(moon.font.tb)\n\n## Show the data around today to see what data above looks like.\nMoon_2022_df %>% filter(between(date,today()-3,today()+3)) %>% datatable()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-26a34b1e18a8484aa3c3\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-26a34b1e18a8484aa3c3\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\"],[\"2022-11-05\",\"2022-11-06\",\"2022-11-07\",\"2022-11-08\",\"2022-11-09\",\"2022-11-10\",\"2022-11-11\"],[0.877098861611855,0.939902537694047,0.980597176791684,0.998803152932537,0.995372276382852,0.972051892836037,0.931130232953849],[0.385986994147449,0.421163496447115,0.455516688157959,0.488985719662366,0.521670521849612,0.553465093970557,0.584524046620125],[-2.05630426967343,-2.05968106327459,-2.04638167248913,-2.06411956357507,1.26056987054231,1.31579056417061,1.4033057076856],[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],[45,45,45,45,45,45,45],[\"Nov\",\"Nov\",\"Nov\",\"Nov\",\"Nov\",\"Nov\",\"Nov\"],[5,6,7,8,9,10,11],[\"(0.375,0.393]\",\"(0.411,0.429]\",\"(0.446,0.464]\",\"(0.482,0.5]\",\"(0.518,0.536]\",\"(0.536,0.554]\",\"(0.571,0.589]\"],[2,2,2,2,2,2,2],[\"k\",\"l\",\"m\",\"0\",\"n\",\"n\",\"o\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>date<\\/th>\\n      <th>fraction<\\/th>\\n      <th>phase<\\/th>\\n      <th>angle<\\/th>\\n      <th>wkdy<\\/th>\\n      <th>wkn<\\/th>\\n      <th>mo<\\/th>\\n      <th>day<\\/th>\\n      <th>moon.phase<\\/th>\\n      <th>wkn.mo<\\/th>\\n      <th>moon.font<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,6,8,10]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n# moon phrase data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gggibbous)\nMoon_df <- Moon_2022_df %>% filter(date>\"2022-8-25\" & date < \"2022-9-15\")\nMoon_df %>% ggplot(aes(x=date, y=fraction)) + \n  geom_moon(aes(ratio = fraction), size = 18, fill = \"#FFDE00\", color=\"#FFF38C\") +\n    ylim(0,1.05)+\n    theme(\n    panel.grid = element_blank(),\n    axis.ticks = element_blank(),\n    axis.title = element_text(size = 12, family = \"Roboto\"),\n    axis.text.x = element_text(size = 18, family = \"Roboto\", color = \"white\"),\n    axis.text.y = element_blank(),\n    plot.caption = element_text(color = \"white\"),\n    plot.title = element_text(size = 28, face = \"bold\", color = \"white\", family=\"Lato\"),\n    plot.subtitle = element_text(size = 20, color = \"yellow\",family=\"Lato\"),\n    axis.line.y = element_blank(),\n    axis.line.x = element_line(color = \"white\"),\n    panel.background = element_rect(fill=\"black\"),\n    plot.background = element_rect(fill =\"black\",color=\"black\"),\n  )+\n  labs(\n    title = \"Moon Phrase\",\n    subtitle = \"Aug.25 - Sep.15\",\n    y = NULL,\n    x = NULL,\n    caption = \"Data Source:R-suncalc\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(filename = \"Moon-Phrase.pdf\", plot = last_plot(), height = 6, width = 8)\npdftools::pdf_convert(\n  pdf = \"Moon-Phrase.pdf\",\n  filenames = \"Moon-Phrase.png\",\n  format = \"png\", \n  dpi = 200\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nConverting page 1 to Moon-Phrase.png... done!\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Moon-Phrase.png\"\n```\n:::\n:::\n\n\nRef: https://www.r-bloggers.com/2018/05/making-calendar-with-ggplot-moon-phase-calendar-for-fun/\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\r\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/datatables-binding-0.26/datatables.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\r\n<link href=\"../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\r\n<link href=\"../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}